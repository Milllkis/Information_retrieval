# Information Retrieval API
# Документация проекта

## Введение

Этот проект представляет собой систему для хранения и управления биографическими данными. Проект включает в себя создание базы данных, настройку таблиц, операции CRUD (создание, чтение, обновление, удаление) и выполнение различных запросов к базе данных.

## Логическая схема базы данных

![Логическая схема](drawing.png)

### Описание таблиц и атрибутов

1. **Person**
   - `id` (INT, AUTO_INCREMENT, PRIMARY KEY): Уникальный идентификатор человека.
   - `name` (VARCHAR(255), NOT NULL): Имя человека.

2. **Biography**
   - `id` (INT, AUTO_INCREMENT, PRIMARY KEY): Уникальный идентификатор биографии.
   - `person_id` (INT): Идентификатор человека, на которого ссылается биография.
   - `text` (TEXT, NOT NULL): Текст биографии.
   - `link` (VARCHAR(255), NOT NULL): Ссылка на биографию.
   - `FOREIGN KEY (person_id) REFERENCES Person(id)`: Внешний ключ, ссылающийся на таблицу Person.

3. **Categories**
   - `id` (INT, AUTO_INCREMENT, PRIMARY KEY): Уникальный идентификатор категории.
   - `person_id` (INT): Идентификатор человека, к которому относится категория.
   - `name` (VARCHAR(255), NOT NULL): Название категории.
   - `FOREIGN KEY (person_id) REFERENCES Person(id)`: Внешний ключ, ссылающийся на таблицу Person.

4. **Query**
   - `id` (INT, AUTO_INCREMENT, PRIMARY KEY): Уникальный идентификатор запроса.
   - `query_text` (VARCHAR(255)): Текст запроса.
   - `method` (VARCHAR(50)): Метод поиска.
   - `query_link` (VARCHAR(255)): Ссылка на запрос.

### Ограничения

- Внешние ключи для обеспечения целостности данных между таблицами Person, Biography и Categories.

### Архитектурные решения

- **Реляционная модель данных**: Использование реляционной модели данных для обеспечения целостности и структурированности данных.
- **Нормализация**: Таблицы нормализованы для избежания избыточности данных и обеспечения их целостности.
- **Индексация**: Использование индексов для ускорения поиска и выборки данных.

## Настройка базы данных

### Установка и настройка

*Для настройки базы данных в локальном окружении выполните следующие команды:*

1. Установите MySQL:

```bash
sudo apt-get update
sudo apt-get install mysql-server
sudo systemctl start mysql
```

2. Настройте пользователя и пароль для MySQL:

```bash
sudo mysql -u root -p
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'root';
FLUSH PRIVILEGES;
EXIT;
```

3. Установите необходимые пакеты Python:

```bash
pip install -r requirements.txt
```

4. Запустите скрипт для создания базы данных и таблиц:

```bash
python connect.py
```

5. Выполните загрузку данных в базу данных:

*С другими CRUD-операциями вы можете ознакомиться ниже.*

```bash
python crud.py --action insert --file /path/to/your/biographies.csv
```

## Операции CRUD

### Вставка данных

Данные вставляются в базу данных из CSV файла с помощью скрипта `crud.py`. Пример команды для вставки данных:

```bash
python crud.py --action insert --file /path/to/your/biographies.csv
```

### Чтение данных

Данные о персоне читаются по ID с помощью скрипта `crud.py`. Пример команды для чтения данных:

```bash
python crud.py --action read --id 1
```

### Обновление данных

Данные персоны и связанные с ней записи обновляются с помощью скрипта `crud.py`. Пример команды для обновления данных:

```bash
python crud.py --action update --id 1 --name "New Name" --bio "New Biography Text" --link "New Link" --category "New Category"
```

### Удаление данных

Персона и связанные с ней данные удаляются по ID с помощью скрипта `crud.py`. Пример команды для удаления данных:

```bash
python crud.py --action delete --id 1
```

## Запросы к базе данных

### Простые запросы

1. **Получение всех людей (максимум 5)**:
   ```sql
   SELECT * FROM Person LIMIT 5
   ```

2. **Поиск биографии по имени человека**:
   ```sql
   SELECT Biography.text FROM Biography
   JOIN Person ON Biography.person_id = Person.id
   WHERE Person.name = 'Xzibit'
   ```

3. **Получение категории для определенного человека (если есть)**:
   ```sql
   SELECT Categories.name FROM Categories
   WHERE person_id = 1
   ORDER BY id LIMIT 1
   ```

### Сложные запросы

1. **Подсчет количества биографий для каждого человека (максимум 5)**:
   ```sql
   SELECT Person.name, COUNT(Biography.id) AS biography_count
   FROM Person
   LEFT JOIN Biography ON Person.id = Biography.person_id
   GROUP BY Person.id
   LIMIT 5
   ```

2. **Общее количество слов в биографиях**:
   ```sql
   SELECT SUM(LENGTH(text) - LENGTH(REPLACE(text, ' ', '')) + 1) AS word_count
   FROM Biography
   ```

3. **Люди и их количество категорий, отсортированные по количеству категорий (максимум 5)**:
   ```sql
   SELECT Person.name, COUNT(Categories.id) AS category_count
   FROM Person
   LEFT JOIN Categories ON Person.id = Categories.person_id
   GROUP BY Person.id
   ORDER BY category_count DESC
   LIMIT 5
   ```

### Проверка

Для быстрой проверки работоспособности всех запросов запустите команду ниже:

```bash
python example_requests.py
```

## Запуск проекта

### Настройка базы данных

Убедитесь, что вы выполнили все шаги выше.

### Запуск сервера

Запустите сервер FastAPI:

```bash
uvicorn main:app --reload
```

### Использование API

Откройте браузер и перейдите по адресу `http://127.0.0.1:8000`. Вы увидите интерфейс, где можно протестировать все доступные эндпоинты API.

## Запуск с помощью CLI

Для работы с базой данных через командную строку с использованием предоставленного скрипта `cli.py`, вам нужно выполнять определенные команды в терминале.

### Основные команды

1. **Приветственное сообщение и инструкции по использованию:**
   ```sh
   python cli.py welcome
   ```
   Эта команда выведет приветственное сообщение и инструкции по использованию CLI.

2. **Поиск по запросу:**
   ```sh
   python cli.py search <ваш запрос> --index <tf-idf|bert>
   ```
   Эта команда выполняет поиск по указанному запросу с использованием выбранного индекса (`tf-idf` или `bert`).

### Примеры использования

1. **Получение приветственного сообщения:**
   ```sh
   python cli.py welcome
   ```
   Вывод:
   ```
   Добро пожаловать в систему поиска!
   Индексация данных будет автоматически загружена из сохраненных файлов при запуске.
   Для поиска используйте команду:
   python cli.py search <ваш запрос> --index <tf-idf|bert>.
   ```

2. **Выполнение поиска с использованием индекса TF-IDF:**
   ```sh
   python cli.py search "Xzibit" --index tf-idf
   ```
   Вывод:
   ```
   Processed data loaded successfully!
   Выполняется поиск по запросу: 'Xzibit' с использованием индекса 'tf-idf'...
   Результаты поиска (TF-IDF):

   --- Результат 1 ---
   ID: 2
   Category: iskusstvo
   Text: Xzibit (Алвин Натаниэль Джойнер) (1974) – рэпер, актер, телеведущий. Родился Алвин в Детройте 18 сентября 1974 года. В возрасте 9 лет после смерти матери переехал вместе с отцом в Нью-Мексико. В 17 лет в биографии Xzibit состоялся переезд в Калифорнию. Музыкальную карьеру начал в составе американской хип-хоп группы «Likwit Crew». После турне с группой в 1995, Xzibit подписал контракт с лейблом «Loud Records» и в 1996 году выпустил дебютный альбом «At the Speed of Life». В этом альбоме был представлен первый его хит «Paparazzi», вошедший в сотню Billboard Hot. Следующим альбомом Xzibit стал альбом «40 Dayz & 40 Nightz», вышедший в 1998 году. В 1999 году рэпер вместе со Snoop Dogg и Dr. Dre презентовал песню «Bitch Please», которая стала одной из известнейших в его карьере. Также вместе с Eminem выпустил песню «What’s the Difference». В 2000 году Dr. Dre пригласил Xzibit принять участие в американском хип-хоп туре «Up in Smoke Tour». В том же году Xzibit выпустил следующий свой альбом «Restless», исполнительным продюсером которого стал Dr. Dre. В этом альбоме был представлен сингл «Х», ставший лучшим хитом рэпера со времен песни «What U See Is What U Get». В 2002 году вышел альбом «Man vs. Machine», а в 2004 – «Weapons of Mass Destruction». Следующими альбомами стали «Full Circle» в 2006, «MMX» в 2010 году. Первое появление в кино в биографии Xzibit произошло в 1999 году («Белая ворона»). Затем он снялся в фильмах «Tha Eastsidaz», «The Slim Shady Show», «The Wash». Одним из известнейших фильмов с участием Xzibit стал фильм с Eminem «8 миля» (фильм получил «Оскар»). В 2004 году Xzibit появился в фильме «Full Clip», в 2005 – в «Derailed», «XXX: State of the Union». В 2007 году рэпер снялся в фильме «Gridiron Gang» вместе с актером Дуэйном «Скала» Джонсоном. В 2008 Xzibit исполнил роль агента ФБР в сериале «The X-Files: I Want to Believe». Среди последних фильмов с участием актера: «American Violet» (2009), «Bad Lieutenant: Port of Call New Orleans» (2009). Xzibit озвучил героев в играх «The Chronicles of Riddick: Escape from Butcher Bay» и «The Chronicles of Riddick: Assault on Dark Athena». Его песни появлялись во многих игрушках, например в «Need for Speed: Underground 2», «Madden NFL 2001», «Juiced», «Tony Hawk’s Pro Skater 3». Xzibit является телеведущим американской программы «Тачка на прокачку», выходящей на канале MTV.
   Link: https://obrazovaka.ru/alpha/x/xzibit-dzhojner-alvin-nataniel-xzibit-joiner-alvin-nat-haniel 
   Оценка релевантности: 0.7070

   --- Результат 2 ---
   ID: 1068
   Category: obshhestvo-kultura-obrazovanie
   Text: Петр Давыдович Калмыков (1808 – 1860) – профессор права. Образование в биографии Калмыкова было получено в третьей гимназии Санкт-Петербурга, затем в университете северной столицы. Перед защитой степени доктора права обучался за границей у выдающихся ученых. В 1835 году им была занята должность профессора. Преподавательская деятельность профессора была чрезвычайно широка. Он был преподавателем в училище правоведения, в Александровском лицее читал историю права, 9 лет занимал должность директора первой гимназии (1840-1849), также работал деканом на факультете юриспруденции. Лекции Калмыкова по правоведению были новизной для России, поэтому профессором, а также его философским методом преподавания многие заинтересовались. В своей биографии Петр Давыдович Калмыков  занимался сбором материалов по истории русского права. Весьма преуспел Калмыков в уголовной праве, всерьез интересуясь анализом науки, законодательства. За всю карьеру Калмыков не успех опубликовать много трудов. Однако те, что были напечатаны, – несомненно, являются достоянием для правоведческих наук, поскольку содержат многие исследования автора, библиографические ссылки, выводы.
   Link: https://obrazovaka.ru/alpha/k/kalmykov-petr-davydovich-kalmiukov-petr-daviudovich 
   Оценка релевантности: 0.6320

   Время выполнения поиска: 0.01 секунд.
   ```

3. **Выполнение поиска с использованием индекса BERT:**
   ```sh
   python cli.py search "Xzibit" --index bert
   ```
   Вывод:
   ```
   Выполняется поиск по запросу: 'Xzibit' с использованием индекса 'bert'...
   Processing BERT embeddings: 100%|
   Результаты поиска (BERT):

   --- Результат 1 ---
   ID: 560
   Category: iskusstvo
   Text: Окинклосс Луис Стантон – американский прозаик. Родился в 1917 году в городе Лоренс, штат Нью-Йорк. В течение многих лет он занимается юридической практикой в своем родном городе. Его бизнес-опыт и социальное происхождение отражены в его романе о нравах обеспеченных слоев общества, которые имеют связи в кругах влиятельных, состоятельных людей из так называемых белых Протестантов. К его романам относятся: “Dark Lady” (1977), “Watchfires” (1982), а также “East End Story” (2004). Он также написал: “Reflections of a Jacobite” (1961), по Генри Джеймсу; “Эдит Уортон: Биография” (1971); “Ришелье” (1972); и конечно же “Вудро Вильсон” (2000). Окинклосс, будучи плодовитым на работы писателем, публикует произведения “Ложные Боги”, “Fellow Passengers” и “Любовь без крыльев” в одиночку. Он также известен и за свои короткие рассказы, которые он долго копил, и в 1994 году они были опубликованы.
   Link: https://obrazovaka.ru/alpha/a/okinkloss-luis-stanton-auchincloss-louis-stanton
   Оценка релевантности: 0.7764

   --- Результат 2 ---
   ID: 755
   Category: iskusstvo
   Text: Адольф Вильям Бугро (1825 – 1905) – французский художник. В 1850 году в биографии Бугро была выиграна награда «Prix de Rome». Наибольшую популярность художник получил в 1860х – 1870х годах. Биография Адольфа Вильяма Бугро известна благодаря его знаменитым картинам с обнаженными телами, а также полотнам на исторические, религиозные тематики. Его работа «La Jeunesse et l’Amour» представлена в Лувре.
   Link: https://obrazovaka.ru/alpha/b/bugero-adolf-vilyam-bouguereau-adolphe-william 
   Оценка релевантности: 0.7575

   Время выполнения поиска: 0.82 секунд.
   ```

### Дополнительные команды

- **Помощь по командам:**
  ```sh
  python cli.py --help
  ```
  Эта команда выведет список доступных команд и их описание.

- **Помощь по команде поиска:**
  ```sh
  python cli.py search --help
  ```
  Эта команда выведет подробную информацию о команде `search`, включая аргументы и опции.

### Запуск без параметров

Если вы запустите скрипт без параметров, будет вызвана команда `welcome` по умолчанию:
```sh
python cli.py
```

Этот скрипт предоставляет удобный интерфейс для выполнения поиска по базе данных с использованием различных индексов. Вы можете легко расширить его функциональность, добавив новые команды и опции по мере необходимости.

## Заключение

Этот проект предоставляет полноценную систему для хранения и управления биографическими данными, а также для выполнения различных запросов к базе данных. С помощью FastAPI и Jinja2 можно легко создавать и управлять веб-приложениями, обеспечивая высокую производительность и удобство использования.

## Additional notes

Результат индексации tf-idf слишком тяжелый для гита, так что он доступен по [ссылке](https://drive.google.com/file/d/1e34hq7UT6xfpeSq95ouuXcqdEyRNGJBT/view?usp=sharing)
